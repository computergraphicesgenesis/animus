<!-- Copyright 2010 Robert Scott Dionne. All Rights Reserved. -->
<html>
  <head>
    <!--
    <script type="application/javascript" src="animus.js"></script>
    -->
    <script type="application/javascript">
      var srcs = [
        'src/base.js',
        'src/dualnumber.js',
        'src/dualquaternion.js',
        'src/dualvector.js',
        'src/quaternion.js',
        'src/vector.js',
        'src/boxman.js',
        'src/scenegraph.js',
        'src/app.js',
        'src/program.js',
        'src/renderer.js',
        'src/shader.js',
        'src/keys.js',
        'src/animus.js'
      ];
      srcs.forEach(function(src) {
        document.write(
            '<script type="application/javascript" src="' +
            src + '"></' + 'script>');
      });
    </script>
    <script id="quatlib" type="x-shader/x-vertex">
      vec4 times(vec4 q, vec4 r) {
        return vec4(r.xyz * q.w +
          q.xyz * r.w +
          cross(q.xyz, r.xyz),
          q.w * r.w - dot(q.xyz, r.xyz));
      }

      vec4 conjugate(vec4 q) {
        return vec4(-q.xyz, q.w);
      }

      vec4 reciprocal(vec4 q) {
        return conjugate(q) / dot(q, q);
      }

      vec3 rotate(vec4 q, vec3 v) {
        return times(times(q, vec4(v, 0)), reciprocal(q)).xyz;
      }

    </script>
    <script id="v0" type="x-shader/x-vertex">
      // Per skeleton uniforms
      uniform mat4 projection;

      // Per limb uniforms
      uniform vec4 rotation;
      uniform vec3 translation;

      // Per vertex attributes
      attribute vec3 position;
      attribute vec3 aNormal;
      attribute vec3 aColor;

      // Per vertex varyings
      varying vec3 vNormal;
      varying vec3 vColor;

      void main() {
        vNormal = rotate(rotation, aNormal);
        vColor = aColor;
        gl_Position = projection *
            vec4(rotate(rotation, position) + translation, 1.0);
      }
    </script>
    <script id="f0" type="x-shader/x-fragment">
      // Per fragment varyings
      varying highp vec3 vNormal;
      varying lowp vec3 vColor;

      void main() {
        highp vec3 light = vec3(0, -1, 0);
        gl_FragColor = vec4(max(-dot(light, vNormal), 0.1) * vColor, 1);
      }
    </script>
    <script id="v1" type="x-shader/x-vertex">
      // Per skeleton uniforms
      uniform mat4 projection;

      // Per limb uniforms
      uniform vec4 rotation;
      uniform vec3 translation;

      // Per vertex attributes
      attribute vec3 position;

      void main() {
        gl_Position = projection *
            vec4(rotate(rotation, position) + translation, 1.0);
      }
    </script>
    <script id="f1" type="x-shader/x-fragment">
      void main() {
        gl_FragColor = vec4(1, 0, 0, 1);
      }
    </script>
  </head>
  <body>
    <div id="stats"></div>
    <canvas id="c"></canvas>
  </body>
</html>
