<!-- Copyright 2010 Robert Scott Dionne. All Rights Reserved. -->
<html>
  <head>
    <!--
    <script type="application/javascript" src="animus.js"></script>
    -->
    <script type="application/javascript">
      var srcs = [
        'src/base.js',
        'src/quaternion.js',
        'src/vector.js',
        'src/scenegraph.js',
        'src/app.js',
        'src/program.js',
        'src/renderer.js',
        'src/shader.js',
        'src/keys.js',
        'src/animus.js'
      ];
      srcs.forEach(function(src) {
        document.write(
            '<script type="application/javascript" src="' +
            src + '"></' + 'script>');
      });
    </script>
    <script id="v" type="x-shader/x-vertex">
      uniform vec4 rotation;
      uniform vec3 translation;
      attribute vec3 position;
      attribute vec3 aColor;
      varying vec3 vColor;

      bool isRoughlyEqual(float expected, float actual, float tolerance) {
        return abs(expected - actual) < tolerance;
      }

      vec4 times(vec4 q, vec4 r) {
        return vec4(r.xyz * q.w +
          q.xyz * r.w +
          cross(q.xyz, r.xyz),
          q.w * r.w - dot(q.xyz, r.xyz));
      }

      vec4 conjugate(vec4 q) {
        return vec4(-q.xyz, q.w);
      }

      vec4 reciprocal(vec4 q) {
        return conjugate(q) / dot(q, q);
      }

      vec3 rotate(vec4 q, vec3 v) {
        return times(times(q, vec4(v, 0)), reciprocal(q)).xyz;
      }

      void main() {
        mat4 perspective = mat4(1);
        perspective[0][0] = 1.0;
        perspective[2][0] = 0.0;
        perspective[1][1] = 1.0;
        perspective[2][1] = 0.0;
        perspective[2][2] = -11.0/9.0;
        perspective[3][2] = -20.0/9.0;
        perspective[2][3] = -1.0;
        perspective[3][3] = 0.0;
        vColor = aColor;
        gl_Position = perspective *
            vec4(rotate(rotation, position) + translation, 1.0);
      }
    </script>
    <script id="f" type="x-shader/x-fragment">
      varying lowp vec3 vColor;

      void main() {
        gl_FragColor = vec4(vColor, 1);
      }
    </script>
  </head>
  <body>
    <canvas id="c"></canvas>
  </body>
</html>
